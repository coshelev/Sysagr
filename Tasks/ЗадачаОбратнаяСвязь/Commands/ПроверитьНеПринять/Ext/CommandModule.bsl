
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
		
	ЗадачаСсылка = ПараметрКоманды;
	
	Доступно = ТипЗнч(ЗадачаСсылка) = Тип("ЗадачаСсылка.ЗадачаОбратнаяСвязь");
	Доступно = Доступно И ЗначениеЗаполнено(ЗадачаСсылка);
	Если Не Доступно Тогда
		Возврат
	КонецЕсли;
	
	ЗадачаКомментарий = "";
	Попытка
		ЗадачаКомментарий = ПараметрыВыполненияКоманды.Источник;
	Исключение
	КонецПопытки;
	
	Если Не ЗначениеЗаполнено(ЗадачаКомментарий) Тогда
		Сообщ = Новый СообщениеПользователю();
		Сообщ.Текст = "Не указан комментарий. Отказано в записи задачи"+ ЗадачаСсылка;
		Сообщ.Сообщить();
	КонецЕсли;
	
	Выполнено = ОбработкаКомандыНаСервере(ЗадачаСсылка, ЗадачаКомментарий);
	Если Не Выполнено Тогда
		Сообщ = Новый СообщениеПользователю();
		Сообщ.Текст = "Ошибка записи задачи "+ ЗадачаСсылка;
		Сообщ.Сообщить();
	//// Для отладки		
	////-------------
	//Иначе
	//	Сообщ = Новый СообщениеПользователю();
	//	Сообщ.Текст = "Записана задача "+ЗадачаСсылка;
	//	Сообщ.Сообщить();
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ОбработкаКомандыНаСервере(ЗадачаСсылка, ЗадачаКомментарий)
	
	ЗначениеПоУмолчанию = Ложь;
	
	Доступно = СтрНайти(ЗадачаСсылка.Наименование, "Обработать")>0;
	Если Не Доступно Тогда
		Возврат ЗначениеПоУмолчанию;
	КонецЕсли;

	ЗадачаОб = ЗадачаСсылка.ПолучитьОбъект();
	Попытка
		ЗадачаОб.ДатаВыполнения  = ТекущаяДата();
		ЗадачаОб.ИсполнительФакт = ПараметрыСеанса.ТекущийПользователь;
		ЗадачаОб.Комментарий 	 = ЗадачаКомментарий;
		ЗадачаОб.ОценкаВыполненияПредшествующейЗадачи = 1;
		ЗадачаОб.Выполнить();
	Исключение
		Данные = ЗадачаСсылка;
		Комментарий = ОписаниеОшибки();
		ОбслуживаниеСервер.ЗарегистрироватьСобытие("Ошибка записи задача", УровеньЖурналаРегистрации.Ошибка, Данные, Комментарий);
		Возврат ЗначениеПоУмолчанию;
	КонецПопытки;
	
	Возврат Истина;
		
КонецФункции
